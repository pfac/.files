#!/bin/sh
set -e


# Detect system
SYSTEM="$(uname)"
case "$SYSTEM" in
  Linux)
    SYSTEM="$SYSTEM:$(lsb_release -is)"
esac

while getopts 'd:' option; do
  case "$option" in
    d)
      cd "$OPTARG"
      ;;
    *)
      echo "Unknown option '$option'" >&2
      exit 2
  esac
done

case "$SYSTEM" in
  Darwin)
    echo '==> Provisioning macOS system with Ansible'
    #ansible-galaxy install -r ansible/requirements.yml
    ansible-playbook ansible/macos.yml
    ;;
  Linux:Ubuntu)
    echo '==> Provisioning Ubuntu system with Ansible (sudo required)'
    ansible-playbook -K ansible/ubuntu.yml
    ;;
  *)
    echo "Current system '$SYSTEM' is not supported. Aborting" >&2
    exit 1
esac

echo '\o/ System provision complete'
