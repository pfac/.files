---
- hosts: localhost
  become: yes
  tasks:
    - name: Ensure APT is up-to-date
      apt:
        name: "*"
        state: latest
        autoclean: yes
        autoremove: yes
        force_apt_get: yes
        update_cache: yes

    - name: Ensure APT packages are installed
      apt:
        name:
          - bash
          - curl
          - git
          - gnome-tweak-tool
          - neovim
          - nodejs
          - pass
          - python
          - ruby
          - tilix
          - tmux
          - vim
          - zsh
        force_apt_get: yes
        update_cache: yes

    - name: Ensure Tilix is the default terminal
      alternatives:
        name: x-terminal-emulator
        path: /usr/bin/tilix.wrapper

- hosts: localhost
  tasks:
    - name: Ensure ASDF is installed
      git:
        repo: https://github.com/asdf-vm/asdf.git
        dest: "{{ lookup('env', 'HOME') }}/.asdf"
        version: v0.6.0

    - name: Load dconf configurations
      shell: "dconf load /{{ item | replace('.', '/') }}/ < '{{ lookup('env', 'HOME') }}/Developer/pfac/.files/dconf/{{ item }}'"
      with_items:
        - com.gexperts.Tilix
        - org.gnome.desktop.input-sources
        - org.gnome.desktop.wm.keybindings

    - name: Install extra fonts
      get_url:
        url: "{{ item.url }}"
        dest: "{{ lookup('env', 'HOME') }}/.local/share/fonts/{{ item.name }}"
      with_items:
        - name: FiraMono-Regular.otf
          url: https://github.com/mozilla/Fira/raw/master/otf/FiraMono-Regular.otf
        - name: FiraMono-Medium.otf
          url: https://github.com/mozilla/Fira/raw/master/otf/FiraMono-Medium.otf
        - name: FiraMono-Bold.otf
          url: https://github.com/mozilla/Fira/raw/master/otf/FiraMono-Bold.otf
        - name: Inconsolata.otf
          url: https://www.levien.com/type/myfonts/Inconsolata.otf
        - name: SourceCodeVariable-Roman.otf
          url: https://github.com/adobe-fonts/source-code-pro/releases/download/variable-fonts/SourceCodeVariable-Roman.otf
        - name: SourceCodeVariable-Italic.otf
          url: https://github.com/adobe-fonts/source-code-pro/releases/download/variable-fonts/SourceCodeVariable-Italic.otf
      register: extra_fonts

    - name: Refresh fonts cache
      shell: "fc-cache -f '{{ lookup('env', 'HOME') }}/.local/share/fonts'"
      when: extra_fonts.changed

- import_playbook: common.yml
