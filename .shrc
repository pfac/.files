#!/usr/bin/env sh
if [[ -z "${SHRC}" ]]; then
  export SHRC='loaded'

  #
  # Proxy
  #
  proxy () {
    while getopts 'v' option; do
      case "$option" in
        l)
          echo "HTTP:  ${HTTP_PROXY:(none)}"
          echo "HTTPS: ${HTTPS_PROXY:(none)}"
          echo "FTP:   ${FTP_PROXY:(none)}"
          echo "SOCKS: ${SOCKS_PROXY:(none)}"
          ;;
        ?)
          echo "Unknown option $option" >&2
          exit 1;
          ;;
      esac;
    done;

    case "$1" in
      di|di.uminho)
        export HTTP_PROXY='http://proxy.di.uminho.pt:3128'
        export HTTPS_PROXY='https://proxy.di.uminho.pt:3128'
        export FTP_PROXY='ftp://proxy.di.uminho.pt:3128'
        export SOCKS_PROXY='socks://socks.di.uminho.pt:1080'
        ;;
      uminho)
        export HTTP_PROXY='http://proxy.uminho.pt:3128'
        export HTTPS_PROXY='https://proxy.uminho.pt:3128'
        export FTP_PROXY='ftp://proxy.uminho.pt:3128'
        export SOCKS_PROXY='socks://socks.uminho.pt:1080'
        ;;
      none)
        unset HTTP_PROXY;
        unset HTTPS_PROXY;
        unset FTP_PROXY;
        unset SOCKS_PROXY;
        ;;
      *)
        ;;
    esac;
  }

  # Add executables in user scope
  if [[ -d "${HOME}/.local/bin" ]]; then
    echo -n "* Setting up local user packages... "
    export PATH="${HOME}/.local/bin:$PATH"
    echo "DONE"
  fi

  # Add libraries in user scope
  if [[ -d "${HOME}/.local/lib" ]]; then
    export LD_LIBRARY_PATH="${HOME}/.local/lib:$LD_LIBRARY_PATH";
  fi

  if type brew &> /dev/null && (brew list | grep asdf &> /dev/null); then
    # Initialize ASDF VM (if installed through Homebrew)
    echo -n '* Setting up asdf... '
    [[ -f /usr/local/opt/asdf/asdf.sh ]] &&
      source /usr/local/opt/asdf/asdf.sh
    echo 'DONE'
  else
    # Initialize ASDF VM (if installed in the home directory)
    if [ -d "${HOME}/.asdf" ]; then
      echo -n "* Setting up asdf... "
      . $HOME/.asdf/asdf.sh
      echo "DONE"
    fi
  fi

  if [[ -f "${HOME}/.cargo/env" ]]; then
    echo -n "* Setting up Rust toolchain... "
    source "${HOME}/.cargo/env"
    echo "DONE"
  fi

  # Add Heroku Toolbelt to PATH
  if [[ -d "/usr/local/heroku/bin" ]]; then
    echo -n "* Setting up Heroku Toolbelt... "
    export PATH="/usr/local/heroku/bin:$PATH"
    echo "DONE"
  fi
fi
